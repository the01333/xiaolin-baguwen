1. 怎么确保分布式缓存和数据库的双写一致性
  一般来说有三种方案:
    1️⃣先更新数据库再更新缓存 / 先更新缓存再更新数据库
      两种方式都存在并发更新问题, 比如先更新数据库再更新缓存的场景, A 请求更新数据库后在更新缓存之前, B 请求也进行更新数据库并更新了缓存, 
    这时 A 请求才完成缓存的更新, 导致数据不一致;
      - 解决方案:
        使用<分布式锁>, 但是对性能有一定损耗, 但缓存命中率高;
    2️⃣先删除缓存, 再更新数据库
      存在并发读写问题, 比如 A 请求进来先删除缓存, 然后 B 请求进来, 发现缓存为空去读取数据库并回填, 导致存入的是旧数据, 然后 A 请求更新完数据,
    导致数据不一致;
      - 解决方案: 
        使用<延迟双删>, 删除完缓存再更新数据库后, 暂停一会儿再删除缓存; 但是延迟的时间不好把控;
    3️⃣先更新数据库, 再删除缓存（推荐）
      也可能出现并发读写问题, 当 A 请求未命中缓存, 从数据库读取数据并填充之前, 请求 B 进来修改了数据库的数据, 并删除了缓存, 
    这时候 A 请求才完成缓存的数据填充, 导致数据的不一致; 但这种概率极低, 因为第一次请求的回填缓存操作正常来说是快于第二次的数据库更新操作的;
    并且由于更新数据库和删除缓存不是原子性操作, 存在分布式事务问题, 如果数据库更新成功, 缓存更新失败, 容易造成数据不一致的问题;
      - 解决方案:
        （1）人工介入
            对于删除缓存的操作加重试次数, 并添加自定义告警, 超过一定次数还失败通知人工介入处理;
        （2）异步处理
            可以通过 MQ 或者监听数据库的 binlog 日志来异步删除缓存, 失败可以自动重试（适合最终一致性的场景）

2. 系统依赖的外部服务接口响应时间不稳定, 怎么处理
  主要分为五步走:
    1️⃣实时监控
      实时监控外部依赖接口的 tp99 耗时情况, 观察近一天的响应情况;
    2️⃣设置合理的超时时间和重试次数
      根据监控的 tp99 耗时的最大值和平均值, 如果是如果是核心接口, 超时时间采用平均值, 重试次数设置为 1; 而非核心接口, 
    超时时间可以设置为最大值, 不设置重试次数;
    3️⃣实现动态设置超时时间和重试次数的能力
      可以借助分布式配置中心如 nacos 并结合自身使用的 rpc 框架如 Dubbo 来实现; 这样可以根据实际情况动态调整超时时间和重试次数, 
    无需发版上线;
    4️⃣添加缓存
      如果依赖的外部接口返回的数据允许出现短暂的数据不一致, 可以把响应结果添加到缓存中, 降低外部接口响应时间不稳定带来的结果;
    5️⃣接口限流
      借助如 sentinel 的限流组件来控制流量, 从而防御性的保护系统

3. 运动步数的排行榜功能如何实现
  1️⃣数据库的 order by
    可以用 MySQL 的 order by 来实现, 用降序排序, 适合数据量小的情况; 但存在性能问题, 如排序的字段没有索引, 需要对所有匹配行排序, 
  造成全表扫描; 如果排序的数据量过多, 超过内存缓冲区, 会使用磁盘临时文件, 大幅降低性能;
    - 优化方案:
      （1）索引优化, 如果排序涉及多个字段, 可以用联合索引;
      （2）减少排序数量, 如仅展示前 100 名用户（有损产品功能）;
      （3）分页查询, 尽量采用深分页的解决方案, 避免全表扫描;
  2️⃣Redis 的 ZSet
    用 ZSet 存储用户实时的运动步数, 其中 score 存储的就是用户的运动步数, 可以通过 ZRANGEBYSCORE 来进行排序

4. 如何给会员快过期的用户推送续费通知（百万级用户平台）
  1️⃣定时任务轮询
    百万级对 MySQL 来说是可以接受的程度, 可以给会员过期时间加索引 + 分页查询（采用深分页的解决方案）来提高查询效率;
  2️⃣延迟触发的时机
    不主动轮询, 当用户上线时才去检查是否快要过期（用户的过期时间如果小于设置的阈值, 触发一次消息通知）; 规避了轮询的资源消耗, 
  但是如果用户一直不登录就无法实现过期提醒;
  3️⃣Redisson 延迟队列
    借助 Redisson 里提供的 RDelayedQueue 实现, 原理是 ZSet 实现延迟队列, score 设置为要过期的时间戳（当前时间 + 30 分钟）, 
  再通过 ZRANGEBYSCORE 扫描过期的用户, 发送消息通知